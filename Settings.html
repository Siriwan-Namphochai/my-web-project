<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Setting</title>

  <!-- Stylesheets -->
  <link rel="stylesheet" href="Style/home.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body>
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo"></div>
      <nav>
        <ul>
          <li>
            <a href="Properties.html">
              <i class="fa fa-home"></i> Properties
            </a>
          </li>
          <li> 
            <li>
            <a href="Member.html">
              <i class="fa fa-users"></i> Members
            </a>
          </li>
          <li> 
            <li class="active">
            <a href="Settings.html">
              <i class="fa fa-cogs"></i> Settings
            </a>
          </li>
          <li> 
            <a href="news-and-activities.html">
              <i class="fa fa-bullhorn"></i>  News & Activities
            </a>
          </li>
          <li> 
            <a href="Promotion.html">
              <i class="fa fa-gift"></i>  Promotion
            </a>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- Main Layout -->
    <div class="main-layout">
      <header class="header">
        <div class="user-info">ad min (admin@gmail.com)</div>
        <button id="btnLogout" type="button" class="btn-logout">
          <i class="fa fa-sign-out-alt"></i> Log Out
        </button>
      </header>


      <main class="content">
        <h1>Setting</h1>
        <form class="form-grid">
          <!-- Left Column -->
          <div class="form-column">
            <label for="propertyNameTH">Property Name (TH)*</label>
            <input type="text" id="propertyNameTH" placeholder="Property Name (TH)" />
          </div>

          <!-- Right Column -->
          <div class="form-column">
            <label for="accountName">Account Name</label>
            <input type="text" id="accountName" placeholder="Account Name" />

          </div>
        </form>

        <!-- Buttons -->
        <div class="form-buttons">
          <button type="clear" class="btn-clear">Clear</button>
          <button type="search" class="btn-Search">Search</button>
        </div>
      </main>
    </div>
  </div>

  <!-- Firebase Script (v12 Modular) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAq7rHIZMiVMOEFiDa6uohhjhFtRZFJypc",
      authDomain: "my-demo-project-27c29.firebaseapp.com",
      databaseURL: "https://my-demo-project-27c29-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "my-demo-project-27c29",
      storageBucket: "my-demo-project-27c29.appspot.com",
      messagingSenderId: "841978784478",
      appId: "1:841978784478:web:a31a537d952b08a33c304f"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    document.getElementById("btnLogout").addEventListener("click", function () {
      // เปลี่ยนหน้าเว็บไปยัง Login.html
      window.location.href = "Login.html";
    });

    document.querySelector(".btn-submit").addEventListener("click", async function (e) {
      e.preventDefault();

      const nameTH = document.getElementById("propertyNameTH").value.trim();
      const nameEN = document.getElementById("propertyNameEN").value.trim();
      const propertyType = document.getElementById("propertyType").value.trim();
      const propertyCode = document.getElementById("propertyCode").value.trim();
      const propertyGroup = document.getElementById("propertyGroup").value.trim();
      const about = document.getElementById("about").value.trim();
      const areaSize = document.getElementById("areaSize").value.trim();
      const unitSize = document.getElementById("unitSize").value.trim();
      const constructionBy = document.getElementById("constructionBy").value.trim();
      const accountName = document.getElementById("accountName").value.trim();
      const accountType = document.getElementById("accountType").value;
      const bankName = document.getElementById("bankName").value;
      const bankBranch = document.getElementById("bankBranch").value.trim();
      const billerId = document.getElementById("billerId").value.trim();
      const active = document.getElementById("active").checked;
      const fundAccount = document.getElementById("fundAccount").checked;

      if (!nameTH || !nameEN) {
        alert("กรุณากรอก Property Name ทั้งภาษาไทยและภาษาอังกฤษ");
        return;
      }

      if (!propertyGroup) {
        alert("กรุณากรอก Property Group");
        return;
      }

      if (!accountType) {
        alert("กรุณากรอก Account Type");
        return;
      }
      if (!bankName) {
        alert("กรุณากรอก Bank Name");
        return;
      }

      const createdAt = new Date().toISOString();

      const detailData = {
        nameTH,
        nameEN,
        propertyType,
        propertyCode,
        propertyGroup,
        about,
        areaSize,
        unitSize,
        constructionBy,
        createdAt
      };

      const bank_accountData = {
        accountName,
        accountType,
        bankName,
        bankBranch,
        billerId,
        active,
        fundAccount,
        createdAt
      };

      try {
        // Create new refs
        const detailRef = push(ref(database, "Details"));
        const bankRef = push(ref(database, "Bank Account"));

        // Save both in parallel
        await Promise.all([
          set(detailRef, detailData),
          set(bankRef, bank_accountData)
        ]);

        alert("บันทึกข้อมูลสำเร็จ");
        document.querySelector("form.form-grid").reset();

      } catch (error) {
        alert("เกิดข้อผิดพลาด: " + error.message);
      }
    });
  </script>
</body>

</html>